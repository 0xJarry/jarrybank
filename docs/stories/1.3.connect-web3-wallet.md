# Story 1.3: Connect Web3 Wallet

## Status
Draft

## Story
**As a** crypto user  
**I want to** connect my Web3 wallet to JarryBank  
**So that** I can view my token portfolio without creating accounts or passwords

## Acceptance Criteria
- [ ] RainbowKit and Wagmi 2.16+ integration configured
- [ ] "Connect Wallet" button prominently displayed on landing page
- [ ] System supports MetaMask, WalletConnect, and major wallet providers via RainbowKit
- [ ] Smart contract wallet support (Coinbase Smart Wallet, Argent)
- [ ] Connection process completes in < 5 seconds
- [ ] User sees their wallet address displayed after successful connection
- [ ] User can switch between multiple connected accounts
- [ ] System displays clear error messages for connection failures
- [ ] Connection persists across browser sessions until explicitly disconnected

## Tasks / Subtasks
- [ ] Configure RainbowKit and Wagmi providers (AC: 1, 3, 4)
  - [ ] Install RainbowKit v2.2.0+ and Wagmi v2.16+ dependencies
  - [ ] Configure Avalanche C-Chain RPC providers (Alchemy + Infura) in lib/web3-config.ts
  - [ ] Set up RainbowKit with custom theme matching JarryBank branding
  - [ ] Configure wallet list to include MetaMask, WalletConnect, Coinbase Smart Wallet, Argent
  - [ ] Create Web3 provider wrapper components in apps/web/src/components/wallet/
- [ ] Implement wallet connection UI components (AC: 2, 6, 7)
  - [ ] Replace placeholder "Connect Wallet" button on landing page with RainbowKit ConnectButton
  - [ ] Create custom WalletStatus component to display connected wallet address
  - [ ] Add wallet account switcher interface for multiple accounts
  - [ ] Style components to match existing Tailwind CSS 4.0 design system
- [ ] Configure Web3 state management (AC: 6, 7, 9)
  - [ ] Set up Zustand store for wallet state in stores/wallet-store.ts
  - [ ] Implement wallet connection persistence using localStorage
  - [ ] Create custom hooks in hooks/ for wallet connection management
  - [ ] Add error handling states and user-friendly error messages
- [ ] Implement connection flow and validation (AC: 5, 8)
  - [ ] Add connection timeout handling (5 second limit)
  - [ ] Implement connection error states with retry functionality
  - [ ] Add loading states and progress indicators during connection
  - [ ] Test connection persistence across browser sessions
- [ ] Add minimal tests using wagmi testing utilities (Testing Requirements)
  - [ ] Test wallet connection component renders with wagmi mock
  - [ ] Test basic connection state with wagmi test utilities
  - [ ] Integration test with wagmi mock connector

## Dev Notes

### Previous Story Insights
Story 1.2 successfully implemented:
- Professional landing page with header, hero section, features, and footer
- Tailwind CSS 4.0 styling with proper responsive design
- "Connect Wallet" placeholder button in hero section ready to be replaced
- All components following TypeScript and Next.js App Router patterns
[Source: Story 1.2 implementation]

### Data Models
**Wallet Interface:**
- Must use `address: \`0x${string}\`` type for compile-time address validation
- Include chainId, isConnected, connector, and optional ensName fields
- Connection state managed through Zustand store pattern
[Source: architecture/data-models.md#wallet]

**State Structure:**
```typescript
interface WalletState {
  address: `0x${string}` | null;
  isConnected: boolean;
  chainId: number;
  connector?: string;
  setWallet: (wallet: WalletInfo) => void;
  disconnect: () => void;
}
```
[Source: architecture/frontend-architecture.md#state-management-architecture]

### Component Specifications
**Wallet Components Organization:**
- Location: `apps/web/src/components/wallet/`
- Follow PascalCase naming: WalletConnectButton, WalletStatus, AccountSwitcher
- Use shadcn/ui base components for consistent styling
[Source: architecture/unified-project-structure.md#component-organization]

**Provider Setup:**
- Root layout must wrap app with Web3 providers at `apps/web/src/app/layout.tsx`
- Configuration files in `apps/web/src/lib/web3-config.ts`
[Source: architecture/frontend-architecture.md#component-architecture]

### API Specifications
No API endpoints required for this story - wallet connection is client-side only
[Source: No specific guidance found in architecture docs]

### File Locations
Based on project structure, create/modify files at:
- `apps/web/src/lib/web3-config.ts` - RainbowKit and Wagmi configuration
- `apps/web/src/components/wallet/` - Wallet-specific components
- `apps/web/src/stores/wallet-store.ts` - Wallet state management
- `apps/web/src/hooks/useWallet*.ts` - Custom wallet hooks
- `apps/web/src/app/layout.tsx` - Add Web3 providers (modify existing)
- `apps/web/src/app/page.tsx` - Replace connect button (modify existing)
[Source: architecture/unified-project-structure.md]

### Technical Constraints
- Use TypeScript with strict mode and proper wallet address typing
- Follow ESLint and Prettier configurations from previous stories
- Ensure compatibility with Next.js App Router and server components
- RainbowKit must integrate with existing Tailwind CSS 4.0 theme
- Use Avalanche C-Chain (chainId: 43114) as primary network
- Connection timeout must not exceed 5 seconds per AC requirement
[Source: architecture/coding-standards.md#critical-fullstack-rules]

### Web3 Technology Stack
**Core Libraries:**
- Wagmi v2.16+ for React hooks and Web3 functionality
- Viem v2.21.0+ as TypeScript Ethereum library (required by Wagmi)
- RainbowKit v2.2.0+ for wallet connection UI and provider support
- Avalanche C-Chain as primary blockchain network
[Source: architecture/tech-stack.md#web3-libraries]

**RPC Providers:**
- Primary: Alchemy Avalanche endpoint
- Fallback: Infura Avalanche endpoint  
- Configuration: Redundancy and reliability for connection stability
[Source: architecture/tech-stack.md#rpc-providers]

### Testing Requirements
**Test Organization:**
- Component tests: `apps/web/tests/components/wallet/`
- Hook tests: `apps/web/tests/hooks/`
- Use Vitest v2.1.0 for unit testing framework
[Source: architecture/testing-strategy.md#test-organization]

**Minimal Tests for This Story (MVP Focus):**
- Wallet connection component renders correctly using wagmi mock connectors
- Basic connection state management works with wagmi test utilities
- One integration test using wagmi's createConfig with mock transport
[Source: architecture/testing-strategy.md#testing-pyramid]

**Wagmi Testing Tools:**
- Vitest + React Testing Library for component tests
- Wagmi test utilities (@wagmi/core/test) for mocking wallet connections
- Wagmi mock connectors for testing without real wallet connections
[Source: architecture/testing-strategy.md]

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-10 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-08-10 | 1.1 | Fixed wagmi testing approach, reduced to minimal tests, corrected version consistency | Sarah (Product Owner) |

## Dev Agent Record
### Agent Model Used
[To be filled by Dev Agent]

### Debug Log References
[To be filled by Dev Agent]

### Completion Notes List
[To be filled by Dev Agent]

### File List
[To be filled by Dev Agent]

## QA Results
[To be filled by QA Agent]